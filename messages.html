<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *" />
    <!-- Good default declaration:
    * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
    * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
    * Disables use of eval() and inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
        * Enable inline JS: add 'unsafe-inline' to default-src
        * Enable eval(): add 'unsafe-eval' to default-src
    * Create your own at http://cspisawesome.com
    -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: 'unsafe-inline' https://ssl.gstatic.com; style-src 'self' 'unsafe-inline'; media-src *" /> -->

    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" type="text/css" href="css/bars.css" />
    <link rel="stylesheet" href="./css/css/fontawesome-all.css" />
    <script type="text/javascript" src="js/jsonQ/jsonQ.min.js"></script>
    <link rel="manifest" href="./manifest.json">
    <!-- <link rel="stylesheet" type="text/css" href="progress/progress.css" /> -->
    <title>Eazy-T: Messages</title>
    <!-- <meta name="viewport" content="width=device-width" /> -->
    <!-- <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> -->

</head>
<body id="main" onload="main()">
<script>
	function main() {
	  if("apiKey" in localStorage){
	    	alertify.success('API key found');
		} 
		else {
      window.location="intro.html";
		}
	}//END

  var getJSON = function(url, callback) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.responseType = 'json';
      xhr.onload = function() {
        var status = xhr.status;
        if (status === 200) {
          callback(null, xhr.response);
        } else {
          callback(status, xhr.response);
        }
      };
      xhr.send();
  };

  getJSON('https://api.torn.com/user/?selections=messages&key=' + localStorage.apiKey,
    function(err, data) {
    if (err !== null) {
    alertify.error('Cannot retrieve messages: ' + err);
    }
    else {
    var messages = jsonQ(data),
    //to find all the name
    messagesS = messages.find('title');
    var messagesSName = messages.find('name');
    
    messagesS = messagesS.value();
    messagesS = messagesS.reverse(); 
    
    messagesSName = messagesSName.value();
    messagesSName = messagesSName.reverse();
    
    var result = messagesS.reduce(function(arr, v, i) {
                              return arr.concat(v, messagesSName[i]); 
                           }, []);
    document.getElementById("list0").innerHTML = result[0] + ' // ' + result[1];
    document.getElementById("list1").innerHTML = result[2] + ' // ' + result[3];
    document.getElementById("list2").innerHTML = result[4] + ' // ' + result[5];
    document.getElementById("list3").innerHTML = result[6] + ' // ' + result[7];
    document.getElementById("list4").innerHTML = result[8] + ' // ' + result[9];
    document.getElementById("list5").innerHTML = result[10] + ' // ' + result[11];
    document.getElementById("list6").innerHTML = result[12] + ' // ' + result[13];
    document.getElementById("list7").innerHTML = result[14] + ' // ' + result[15];
    document.getElementById("list8").innerHTML = result[16] + ' // ' + result[17];
    document.getElementById("list9").innerHTML = result[18] + ' // ' + result[19];
    document.getElementById("list10").innerHTML = result[20] + ' // ' + result[21];
    document.getElementById("list11").innerHTML = result[22] + ' // ' + result[23];
    document.getElementById("list12").innerHTML = result[24] + ' // ' + result[25];
    document.getElementById("list13").innerHTML = result[26] + ' // ' + result[27];
    document.getElementById("list14").innerHTML = result[28] + ' // ' + result[29];
    document.getElementById("list15").innerHTML = result[30] + ' // ' + result[31];
    document.getElementById("list16").innerHTML = result[32] + ' // ' + result[33];
    document.getElementById("list17").innerHTML = result[34] + ' // ' + result[35];
    document.getElementById("list18").innerHTML = result[36] + ' // ' + result[37];
    document.getElementById("list19").innerHTML = result[38] + ' // ' + result[39];
    document.getElementById("list20").innerHTML = result[40] + ' // ' + result[41];
    document.getElementById("list21").innerHTML = result[42] + ' // ' + result[43];
    document.getElementById("list22").innerHTML = result[44] + ' // ' + result[45];
    document.getElementById("list23").innerHTML = result[46] + ' // ' + result[47];
    document.getElementById("list24").innerHTML = result[48] + ' // ' + result[49];
    document.getElementById("list25").innerHTML = result[50] + ' // ' + result[51];
    document.getElementById("list26").innerHTML = result[52] + ' // ' + result[53];
    document.getElementById("list27").innerHTML = result[54] + ' // ' + result[55];
    document.getElementById("list28").innerHTML = result[56] + ' // ' + result[57];
    document.getElementById("list29").innerHTML = result[58] + ' // ' + result[59];
    document.getElementById("list30").innerHTML = result[60] + ' // ' + result[61];
    document.getElementById("list31").innerHTML = result[62] + ' // ' + result[63];
    document.getElementById("list32").innerHTML = result[64] + ' // ' + result[65];
    document.getElementById("list33").innerHTML = result[66] + ' // ' + result[67];
    document.getElementById("list34").innerHTML = result[68] + ' // ' + result[69];
    document.getElementById("list35").innerHTML = result[70] + ' // ' + result[70];
    document.getElementById("list36").innerHTML = result[72] + ' // ' + result[73];
    document.getElementById("list37").innerHTML = result[74] + ' // ' + result[75];
    document.getElementById("list38").innerHTML = result[76] + ' // ' + result[77];
    document.getElementById("list39").innerHTML = result[78] + ' // ' + result[79];
    }
  });

    

	//Reloads the current window.
	function reloadApp(){window.location.reload()}
  
    function goHome() {
    window.location="index.html";
  }

</script>
    <table border="0" cellpadding="0" cellspacing="0" class="body">
      <tr>
        <td>&nbsp;</td>
        <td class="container">
          <div class="content">
            <!-- START CENTERED WHITE CONTAINER -->
            <table class="main">
              <!-- START MAIN CONTENT AREA -->
              <tr>
                <td class="wrapper">
                  <table border="0" cellpadding="0" cellspacing="0">
                    <tr>
                      <td>
                        <a onclick="goHome()"><h1 id="playername">Eazy-T</h1></a>
                        <ol>
                                <li><span id="list0"></span></li>
                                <li><span id="list1"></span></li>
                                <li><span id="list2"></span></li>
                                <li><span id="list3"></span></li>
                                <li><span id="list4"></span></li>
                                <li><span id="list5"></span></li>
                                <li><span id="list6"></span></li>
                                <li><span id="list7"></span></li>
                                <li><span id="list8"></span></li>
                                <li><span id="list9"></span></li>
                                <li><span id="list10"></span></li>
                                <li><span id="list11"></span></li>
                                <li><span id="list12"></span></li>
                                <li><span id="list13"></span></li>
                                <li><span id="list14"></span></li>
                                <li><span id="list15"></span></li>
                                <li><span id="list16"></span></li>
                                <li><span id="list17"></span></li>
                                <li><span id="list18"></span></li>
                                <li><span id="list19"></span></li>
                                <li><span id="list20"></span></li>
                                <li><span id="list21"></span></li>
                                <li><span id="list22"></span></li>
                                <li><span id="list23"></span></li>
                                <li><span id="list24"></span></li>
                                <li><span id="list25"></span></li>
                                <li><span id="list26"></span></li>
                                <li><span id="list27"></span></li>
                                <li><span id="list28"></span></li>
                                <li><span id="list29"></span></li>
                                <li><span id="list30"></span></li>
                                <li><span id="list31"></span></li>
                                <li><span id="list32"></span></li>
                                <li><span id="list33"></span></li>
                                <li><span id="list34"></span></li>
                                <li><span id="list35"></span></li>
                                <li><span id="list36"></span></li>
                                <li><span id="list37"></span></li>
                                <li><span id="list38"></span></li>
                                <li><span id="list39"></span></li>
                        </ol>
                        <p></p>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            <!-- END MAIN CONTENT AREA -->
            </table>
            <!-- START FOOTER -->
            <div class="footer">
              <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                  <td class="content-block">
                        <table class="btn btn-primary">
                          <tbody>
                            <tr>
                              <td>
                                <center><table border="0" cellpadding="0" cellspacing="15">
                                  <tbody>
                                    <tr>
                                      <td> <a onclick="goHome()"><i class="fas fa-home fa-2x"></i></a> </td>
                                    </tr>
                                  </tbody>
                                </table></center>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                  </td>
                </tr>
                <tr>
                  <td>
                    Created by: <a href="https://www.torn.com/profiles.php?XID=1947498">Eazy-E</a>
                  </td>
                </tr>
              </table>
            </div>
            <!-- END FOOTER -->
          <!-- END CENTERED WHITE CONTAINER -->
          </div>
        </td>
        <td>&nbsp;</td>
      </tr>
    </table>
    <script src="//unpkg.com/hammer-touchemulator@0.0.2/touch-emulator.js"></script>
    <script>TouchEmulator()</script>
    <script type="text/javascript" src="js/pulltorefresh-js-0.1.14/dist/pulltorefresh.js"></script>
    <script type="text/javascript" src="js/alertify.js"></script>
    
    <script>
      /* global PullToRefresh */
      PullToRefresh.init({
        mainElement: '#main',
        onRefresh: function() { reloadApp(); }
      });
    </script>
  </body>
</html>
